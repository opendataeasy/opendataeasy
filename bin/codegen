#!/usr/bin/env sh
set -o errexit -o nounset -o xtrace

WORKSPACE="${WORKSPACE:?}"
MODULE="${MODULE:?}"

class_name="$(basename "$MODULE")"
src_dir="packages/$WORKSPACE/src/$(dirname "$MODULE")"
tests_dir="packages/$WORKSPACE/test/$(dirname "$MODULE")"
src="$src_dir/$class_name.ts"
tests="$tests_dir/$class_name.test.ts"
fixture="$tests_dir/$class_name.fixture.ts"
tests_to_src="$(node -p "path.relative('$tests_dir', '$src_dir/$class_name')")"

mkdir -p "$src_dir" "$tests_dir"

cat <<TS > "$src"
class $class_name {
  method() {
    return this;
  }
};

export default $class_name;
TS

cat <<TS > "$tests"
import $class_name from "$tests_to_src";

describe("$class_name", () => {
  describe("method", () => {
    it("should return an object", () => {
      const obj = new $class_name()
      expect(obj.method()).toEqual(obj);
    });
  });
});
TS

cat <<TS > "$fixture"
const fixture = {};

export default fixture;
TS

git add "$src" "$tests" "$fixture"
git status -s
