#!/usr/bin/env sh
set -o errexit -o nounset -o xtrace

WORKSPACE="${WORKSPACE:?}"
MODULE="${MODULE:?}"

class_name="$(basename "$MODULE")"
src_dir="packages/$WORKSPACE/src/$(dirname "$MODULE")"
tests_dir="packages/$WORKSPACE/test/$(dirname "$MODULE")"
src="$src_dir/$class_name.ts"
tests="$tests_dir/$class_name.test.ts"
fixture="$tests_dir/$class_name.fixture.ts"
tests_to_src="$(node -p "path.relative('$tests_dir', '$src_dir/$class_name')")"

mkdir -p "$src_dir" "$tests_dir"

cat <<TS > "$src"
const $class_name = {};

export default $class_name;
TS

cat <<TS > "$tests"
import $class_name from "$tests_to_src";

describe("$class_name", () => {
  describe("TODO", () => {
    it("should be an object", () => {
      expect($class_name).toBeInstanceOf(Object);
    });
  });
});
TS

cat <<TS > "$fixture"
const fixture = {};

export default fixture;
TS

git add "$src" "$tests" "$fixture"
git status -s
